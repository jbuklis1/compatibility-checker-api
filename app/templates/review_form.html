<h1>Review files for cross-platform compatibility</h1>
<p>Select one or more files, a zip archive, or a folder. The app will automatically detect what you selected and run the appropriate analysis.</p>
{error_block}

<form method="post" action="/review/upload" enctype="multipart/form-data" id="review-form">
  <div class="upload-choices">
    <div>
      <label for="source-files">Select file(s) or archive</label>
      <input type="file" id="source-files" name="files" multiple accept=".py,.js,.ts,.jsx,.tsx,.c,.cpp,.h,.hpp,.zip">
    </div>
    <div>
      <label for="source-folder">Or select a folder</label>
      <input type="file" id="source-folder" name="files" multiple webkitdirectory>
    </div>
  </div>
  <div>
    <small id="selection-summary">No selection yet.</small>
  </div>
  <div>
    <button type="submit" id="analyze-btn" disabled>Analyze</button>
  </div>
</form>

<script>
(function() {{
  const inputFiles = document.getElementById('source-files');
  const inputFolder = document.getElementById('source-folder');
  const summary = document.getElementById('selection-summary');
  const button = document.getElementById('analyze-btn');

  function classify(files) {{
    if (!files || files.length === 0) {{
      return {{ type: 'none', count: 0, names: [] }};
    }}
    const arr = Array.from(files);
    const count = arr.length;
    const names = arr.slice(0, 5).map(f => f.name || '');
    if (count === 1) {{
      const name = arr[0].name || '';
      if (name.toLowerCase().endsWith('.zip')) {{
        return {{ type: 'archive', count, names }};
      }}
      return {{ type: 'single', count, names }};
    }}
    const hasRelative = arr.some(f => 'webkitRelativePath' in f && f.webkitRelativePath);
    return {{ type: hasRelative ? 'folder' : 'multiple', count, names }};
  }}

  function updateSummary(files) {{
    const info = classify(files);
    if (info.type === 'none') {{
      summary.textContent = 'No file selected.';
      button.disabled = true;
      return;
    }}
    let label;
    if (info.type === 'single') label = 'Single file';
    else if (info.type === 'archive') label = 'Zip archive';
    else if (info.type === 'folder') label = 'Folder / tree selection';
    else label = 'Multiple files';
    summary.textContent = label + ' selected (' + info.count + ' item(s)). Examples: ' + info.names.join(', ');
    button.disabled = false;
  }}

  inputFiles.addEventListener('change', function() {{
    if (this.files && this.files.length > 0) {{
      inputFolder.value = '';
      updateSummary(this.files);
    }} else {{
      updateSummary(inputFolder.files);
    }}
  }});

  inputFolder.addEventListener('change', function() {{
    if (this.files && this.files.length > 0) {{
      inputFiles.value = '';
      updateSummary(this.files);
    }} else {{
      updateSummary(inputFiles.files);
    }}
  }});
}})();
</script>

<p style="margin-top: 2rem;"><a href="/">Home</a> · <a href="/docs">Swagger UI</a> · <a href="/redoc">ReDoc</a> · <a href="/health">Health</a></p>
